# üì± Configura√ß√£o do WhatsApp para ZK Premios

Este guia explica como configurar as notifica√ß√µes WhatsApp usando o Twilio.

## üöÄ Passo 1: Criar conta no Twilio

1. Acesse: https://www.twilio.com/
2. Crie uma conta gratuita
3. Verifique seu n√∫mero de telefone
4. Acesse o Console do Twilio

## üîë Passo 2: Obter credenciais

No Console do Twilio:

1. **Account SID**: Encontre em "Account Info" ‚Üí "Account SID"
2. **Auth Token**: Clique em "Show" ao lado do Auth Token
3. **WhatsApp Number**: V√° em "Phone Numbers" ‚Üí "Manage" ‚Üí "Active numbers"

## üì± Passo 3: Configurar WhatsApp Sandbox

Para testes (gratuito):

1. Acesse: https://console.twilio.com/us1/develop/sms/try-it-out/whatsapp-learn
2. Escaneie o QR Code com seu WhatsApp
3. Envie a mensagem de confirma√ß√£o
4. Use o n√∫mero do sandbox: `whatsapp:+14155238886`

## ‚öôÔ∏è Passo 4: Configurar no projeto

Edite o arquivo `.env`:

```env
# WhatsApp/Twilio Configuration
VITE_TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
VITE_TWILIO_AUTH_TOKEN=seu_auth_token_aqui
VITE_TWILIO_WHATSAPP_FROM=whatsapp:+14155238886
VITE_APP_URL=http://localhost:5173
```

## üéØ Funcionalidades implementadas

### 1. **Confirma√ß√£o de Cadastro**
- Enviado automaticamente quando usu√°rio se registra
- Inclui c√≥digo de confirma√ß√£o
- Link direto para o app

### 2. **Notifica√ß√£o de N√∫meros**
- Enviado quando n√∫meros s√£o atribu√≠dos
- Lista os n√∫meros selecionados
- Link para visualizar n√∫meros

### 3. **Aprova√ß√£o de N√∫meros Extras**
- Enviado quando admin aprova solicita√ß√£o
- Inclui n√∫meros aprovados e valor pago
- Confirma√ß√£o de pagamento

### 4. **Novos Sorteios**
- Notifica todos os usu√°rios sobre novos sorteios
- Enviado pelo painel administrativo
- Inclui detalhes do pr√™mio e per√≠odo

### 5. **An√∫ncio de Ganhadores**
- Notifica resultado do sorteio
- Diferencia mensagem para ganhador/perdedor
- Link para ver resultado completo

## üõ†Ô∏è Como usar

### Para Administradores:

1. **Enviar notifica√ß√£o de novo sorteio:**
   ```javascript
   await notifyAllUsersAboutNewRaffle({
     title: "Sorteio iPhone 15 Pro Max",
     prize: "iPhone 15 Pro Max 256GB",
     startDate: "2025-01-01",
     endDate: "2025-01-31"
   });
   ```

2. **Notificar aprova√ß√£o de n√∫meros extras:**
   ```javascript
   await notifyExtraNumbersApproved("request-id-here");
   ```

### Para Desenvolvedores:

```javascript
import { useWhatsApp } from './hooks/useWhatsApp';

const { sendRegistrationConfirmation, loading, error } = useWhatsApp();

// Enviar confirma√ß√£o de cadastro
await sendRegistrationConfirmation({
  name: "Jo√£o Silva",
  email: "joao@email.com",
  whatsapp: "+5511999999999",
  confirmationCode: "123456"
});
```

## üìä Logs e Monitoramento

Todas as notifica√ß√µes s√£o logadas na tabela `notification_logs`:

- **Status**: sent, failed, pending
- **Message SID**: ID da mensagem no Twilio
- **Error Message**: Detalhes do erro (se houver)
- **Timestamp**: Data/hora do envio

## üí∞ Custos

### Sandbox (Teste):
- **Gratuito** para testes
- Limitado a n√∫meros verificados

### Produ√ß√£o:
- **$0.005 por mensagem** (aproximadamente R$ 0,025)
- Sem limite de usu√°rios
- Mensagens ilimitadas

## üîß Troubleshooting

### Erro: "WhatsApp service not configured"
- Verifique se as vari√°veis est√£o no `.env`
- Reinicie o servidor ap√≥s alterar `.env`

### Erro: "Failed to send message"
- Verifique se o n√∫mero est√° no formato correto
- Confirme se o WhatsApp est√° configurado no Twilio
- Verifique os logs no Console do Twilio

### Mensagens n√£o chegam:
- Verifique se o n√∫mero est√° no sandbox
- Confirme se o usu√°rio enviou a mensagem de confirma√ß√£o
- Verifique os logs de erro

## üöÄ Produ√ß√£o

Para usar em produ√ß√£o:

1. **Upgrade da conta Twilio** (remover limita√ß√µes do sandbox)
2. **Configurar n√∫mero WhatsApp Business** oficial
3. **Atualizar vari√°veis de ambiente** com credenciais de produ√ß√£o
4. **Configurar webhook** para receber status de entrega

## üìû Suporte

- **Twilio Docs**: https://www.twilio.com/docs/whatsapp
- **WhatsApp Business API**: https://developers.facebook.com/docs/whatsapp/
- **Logs**: Console do Twilio ‚Üí Monitor ‚Üí Logs
